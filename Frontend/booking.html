<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QueueWise Pro - Book Your Slot</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <style>
        .step-indicator {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .step-text {
            transition: color 0.3s ease;
        }

        .slot {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .slot.booked {
            background-color: #ef4444;
            color: white;
            cursor: not-allowed;
        }

        .slot.available:hover {
            background-color: #10b981;
            color: white;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.8s ease forwards;
        }
    </style>
</head>

<body class="bg-gray-50 font-['Inter', sans-serif] scroll-behavior: smooth">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm py-4 px-6 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center">
                <a href="#" class="text-2xl font-['Pacifico'] text-primary">QueueWise Pro</a>
            </div>
            <div class="flex items-center space-x-4">
                <a href="./index.html" class="text-gray-600 hover:text-primary transition-colors">Home</a>
                <a href="./sign_in.html" class="text-gray-600 hover:text-primary transition-colors">Sign In</a>
            </div>
        </div>
    </nav>

    <!-- Booking Section -->
    <section class="py-20 bg-white">
        <div class="max-w-7xl mx-auto px-6">
            <div class="text-center mb-16 animate-fadeIn">
                <h2 class="text-3xl font-bold mb-4">Book Your Slot</h2>
                <p class="text-gray-600 max-w-2xl mx-auto">Select a service center, choose an available time slot, and
                    confirm your booking with AI recommendations.</p>
            </div>
            <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden animate-fadeIn" style="animation-delay: 0.3s;">
                <div class="flex flex-col md:flex-row">
                    <!-- Booking Steps -->
                    <div class="w-full md:w-1/3 bg-white p-6 border-r border-gray-200">
                        <h3 class="text-lg font-semibold mb-6">Booking Steps</h3>
                        <div class="space-y-4" id="bookingSteps">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center mr-3 step-indicator active"
                                    data-step="1">
                                    <span class="text-sm">1</span>
                                </div>
                                <span class="text-primary font-medium step-text">Select Service Center</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gray-200 text-gray-600 rounded-full flex items-center justify-center mr-3 step-indicator"
                                    data-step="2">
                                    <span class="text-sm">2</span>
                                </div>
                                <span class="text-gray-600 step-text">Choose Date & Time</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gray-200 text-gray-600 rounded-full flex items-center justify-center mr-3 step-indicator"
                                    data-step="3">
                                    <span class="text-sm">3</span>
                                </div>
                                <span class="text-gray-600 step-text">Enter Details</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gray-200 text-gray-600 rounded-full flex items-center justify-center mr-3 step-indicator"
                                    data-step="4">
                                    <span class="text-sm">4</span>
                                </div>
                                <span class="text-gray-600 step-text">Confirm Booking</span>
                            </div>
                        </div>
                        <div class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-100" id="aiRecommendation">
                            <div class="flex items-start">
                                <div class="w-6 h-6 flex items-center justify-center text-blue-500 mt-0.5 mr-2">
                                    <i class="ri-lightbulb-line"></i>
                                </div>
                                <div>
                                    <h4 class="text-sm font-semibold text-blue-700 mb-1">AI Recommendation</h4>
                                    <p class="text-xs text-blue-600" id="recommendationText">Analyzing best slots...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Booking Form -->
                    <div class="w-full md:w-2/3 p-6">
                        <!-- Step 1: Select Service Center -->
                        <div class="booking-step active" data-step="1">
                            <h3 class="text-xl font-semibold mb-6">Select Service Center</h3>
                            <div class="mb-6">
                                <label class="block text-gray-700 mb-2">Search by name or location</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                        <div class="w-5 h-5 flex items-center justify-center text-gray-500">
                                            <i class="ri-search-line"></i>
                                        </div>
                                    </div>
                                    <select id="centerSelect"
                                        class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded focus:ring-2 focus:ring-primary/30 focus:outline-none appearance-none">
                                        <option value="" disabled selected>Select a center</option>
                                        <option value="Downtown Medical Center">Downtown Medical Center</option>
                                        <option value="Westside DMV Office">Westside DMV Office</option>
                                        <option value="Eastside Tax Office">Eastside Tax Office</option>
                                    </select>
                                </div>
                            </div>
                            <button
                                class="bg-primary text-white px-6 py-3 !rounded-button hover:bg-primary/90 transition-colors"
                                id="nextStep1">Continue</button>
                        </div>
                        <!-- Step 2: Choose Date & Time -->
                        <div class="booking-step hidden" data-step="2">
                            <h3 class="text-xl font-semibold mb-6">Choose Date & Time</h3>
                            <div class="mb-6">
                                <label class="block text-gray-700 mb-2">Select Date</label>
                                <input type="date" id="dateInput"
                                    class="w-full px-3 py-2 border border-gray-200 rounded focus:ring-2 focus:ring-primary/30 focus:outline-none"
                                    min="2025-04-27" required>
                            </div>
                            <div class="mb-6">
                                <label class="block text-gray-700 mb-2">Select Time</label>
                                <div id="slotContainer" class="grid grid-cols-3 gap-2"></div>
                            </div>
                            <div class="flex justify-between">
                                <button
                                    class="bg-gray-200 text-gray-700 px-6 py-3 !rounded-button hover:bg-gray-300 transition-colors"
                                    id="prevStep2">Previous</button>
                                <button
                                    class="bg-primary text-white px-6 py-3 !rounded-button hover:bg-primary/90 transition-colors"
                                    id="nextStep2">Continue</button>
                            </div>
                        </div>
                        <!-- Step 3: Enter Details -->
                        <div class="booking-step hidden" data-step="3">
                            <h3 class="text-xl font-semibold mb-6">Enter Details</h3>
                            <div class="mb-6">
                                <label class="block text-gray-700 mb-2">Full Name</label>
                                <input type="text" id="nameInput"
                                    class="w-full px-3 py-2 border border-gray-200 rounded focus:ring-2 focus:ring-primary/30 focus:outline-none"
                                    placeholder="John Doe" required>
                            </div>
                            <div class="mb-6">
                                <label class="block text-gray-700 mb-2">Email Address</label>
                                <input type="email" id="emailInput"
                                    class="w-full px-3 py-2 border border-gray-200 rounded focus:ring-2 focus:ring-primary/30 focus:outline-none"
                                    placeholder="john.doe@example.com" required>
                            </div>
                            <div class="mb-6">
                                <label class="block text-gray-700 mb-2">Phone Number</label>
                                <input type="tel" id="phoneInput"
                                    class="w-full px-3 py-2 border border-gray-200 rounded focus:ring-2 focus:ring-primary/30 focus:outline-none"
                                    placeholder="+1 (123) 456-7890" required>
                            </div>
                            <div class="flex justify-between">
                                <button
                                    class="bg-gray-200 text-gray-700 px-6 py-3 !rounded-button hover:bg-gray-300 transition-colors"
                                    id="prevStep3">Previous</button>
                                <button
                                    class="bg-primary text-white px-6 py-3 !rounded-button hover:bg-primary/90 transition-colors"
                                    id="nextStep3">Continue</button>
                            </div>
                        </div>
                        <!-- Step 4: Confirm Booking -->
                        <div class="booking-step hidden" data-step="4">
                            <h3 class="text-xl font-semibold mb-6">Confirm Booking</h3>
                            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                                <h4 class="font-medium mb-2">Booking Summary</h4>
                                <p class="text-gray-600">Service Center: <span id="summary-center"
                                        class="font-semibold"></span></p>
                                <p class="text-gray-600">Date: <span id="summary-date" class="font-semibold"></span></p>
                                <p class="text-gray-600">Time: <span id="summary-time" class="font-semibold"></span></p>
                                <p class="text-gray-600">Name: <span id="summary-name" class="font-semibold"></span></p>
                                <p class="text-gray-600">Email: <span id="summary-email" class="font-semibold"></span>
                                </p>
                                <p class="text-gray-600">Phone: <span id="summary-phone" class="font-semibold"></span>
                                </p>
                            </div>
                            <p class="text-sm text-gray-600 mb-4">Please review your booking details. You'll receive a
                                confirmation via email with a QR code.</p>
                            <div class="flex justify-between">
                                <button
                                    class="bg-gray-200 text-gray-700 px-6 py-3 !rounded-button hover:bg-gray-300 transition-colors"
                                    id="prevStep4">Previous</button>
                                <button
                                    class="bg-primary text-white px-6 py-3 !rounded-button hover:bg-primary/90 transition-colors"
                                    id="confirmBooking">Confirm Booking</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <p class="text-gray-400 text-sm">© 2025 QueueWise Pro. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Simulated data for wait times (real app would fetch from backend)
        let bookedSlots = new Set();
        const waitTimes = {
            "Downtown Medical Center": [10, 15, 20, 25, 30, 35, 40, 45, 50, 55],
            "Westside DMV Office": [15, 20, 25, 30, 35, 40, 45, 50, 55, 60],
            "Eastside Tax Office": [20, 25, 30, 35, 40, 45, 50, 55, 60, 65]
        };

        // State management
        let currentCenter = "";
        let selectedDate = "";
        let selectedTime = "";

        // Step navigation
        document.getElementById("nextStep1").addEventListener("click", () => {
            currentCenter = document.getElementById("centerSelect").value;
            if (currentCenter) {
                document.querySelector('[data-step="1"]').classList.add("hidden");
                document.querySelector('[data-step="2"]').classList.remove("hidden");
                document.querySelector('[data-step="2"] .step-indicator').classList.replace("bg-gray-200", "bg-primary");
                document.querySelector('[data-step="2"] .step-text').classList.replace("text-gray-600", "text-primary");
                updateSlots();
                updateRecommendation();
            }
        });

        document.getElementById("prevStep2").addEventListener("click", () => {
            document.querySelector('[data-step="2"]').classList.add("hidden");
            document.querySelector('[data-step="1"]').classList.remove("hidden");
            document.querySelector('[data-step="2"] .step-indicator').classList.replace("bg-primary", "bg-gray-200");
            document.querySelector('[data-step="2"] .step-text').classList.replace("text-primary", "text-gray-600");
        });

        document.getElementById("nextStep2").addEventListener("click", () => {
            if (selectedTime) {
                document.querySelector('[data-step="2"]').classList.add("hidden");
                document.querySelector('[data-step="3"]').classList.remove("hidden");
                document.querySelector('[data-step="3"] .step-indicator').classList.replace("bg-gray-200", "bg-primary");
                document.querySelector('[data-step="3"] .step-text').classList.replace("text-gray-600", "text-primary");
            }
        });

        document.getElementById("prevStep3").addEventListener("click", () => {
            document.querySelector('[data-step="3"]').classList.add("hidden");
            document.querySelector('[data-step="2"]').classList.remove("hidden");
            document.querySelector('[data-step="3"] .step-indicator').classList.replace("bg-primary", "bg-gray-200");
            document.querySelector('[data-step="3"] .step-text').classList.replace("text-primary", "text-gray-600");
        });

        document.getElementById("nextStep3").addEventListener("click", () => {
            const name = document.getElementById("nameInput").value;
            const email = document.getElementById("emailInput").value;
            const phone = document.getElementById("phoneInput").value;
            if (name && email && phone) {
                document.querySelector('[data-step="3"]').classList.add("hidden");
                document.querySelector('[data-step="4"]').classList.remove("hidden");
                document.querySelector('[data-step="4"] .step-indicator').classList.replace("bg-gray-200", "bg-primary");
                document.querySelector('[data-step="4"] .step-text').classList.replace("text-gray-600", "text-primary");
                updateSummary(name, email, phone);
            }
        });

        document.getElementById("prevStep4").addEventListener("click", () => {
            document.querySelector('[data-step="4"]').classList.add("hidden");
            document.querySelector('[data-step="3"]').classList.remove("hidden");
            document.querySelector('[data-step="4"] .step-indicator').classList.replace("bg-primary", "bg-gray-200");
            document.querySelector('[data-step="4"] .step-text').classList.replace("text-primary", "text-gray-600");
        });

        // Slot management
        function updateSlots() {
            const slotContainer = document.getElementById("slotContainer");
            slotContainer.innerHTML = "";
            selectedDate = document.getElementById("dateInput").value;
            if (currentCenter && selectedDate) {
                const times = ["09:00", "10:00", "11:00", "14:00", "15:00", "16:00", "17:00"];
                times.forEach(time => {
                    const isBooked = bookedSlots.has(`${currentCenter}-${selectedDate}-${time}`);
                    const waitTime = waitTimes[currentCenter][Math.floor(Math.random() * waitTimes[currentCenter].length)];
                    const slot = document.createElement("button");
                    slot.className = `slot ${isBooked ? "booked" : "available"} px-4 py-2 rounded border border-gray-300 text-sm`;
                    slot.textContent = `${time} (Wait: ${waitTime} min)`;
                    if (!isBooked) {
                        slot.addEventListener("click", () => {
                            selectedTime = time;
                            document.querySelectorAll(".slot.available").forEach(s => s.classList.remove("bg-primary", "text-white"));
                            slot.classList.add("bg-primary", "text-white");
                        });
                    }
                    slotContainer.appendChild(slot);
                });
            }
        }

        document.getElementById("dateInput").addEventListener("change", updateSlots);

        // AI Recommendation
        function updateRecommendation() {
            if (currentCenter && selectedDate) {
                const availableTimes = ["09:00", "10:00", "11:00", "14:00", "15:00", "16:00", "17:00"]
                    .filter(time => !bookedSlots.has(`${currentCenter}-${selectedDate}-${time}`));
                if (availableTimes.length > 0) {
                    const bestTime = availableTimes.reduce((best, current) => {
                        const wait = waitTimes[currentCenter][Math.floor(Math.random() * waitTimes[currentCenter].length)];
                        return wait < waitTimes[currentCenter][Math.floor(Math.random() * waitTimes[currentCenter].length)] ? current : best;
                    }, availableTimes[0]);
                    document.getElementById("recommendationText").textContent = `Based on current data, ${bestTime} has the shortest estimated wait time of ${waitTimes[currentCenter].sort((a, b) => a - b)[0]} minutes.`;
                } else {
                    document.getElementById("recommendationText").textContent = "No available slots today. Please try another date.";
                }
            }
        }

        // Confirmation
        function updateSummary(name, email, phone) {
            document.getElementById("summary-center").textContent = currentCenter;
            document.getElementById("summary-date").textContent = selectedDate;
            document.getElementById("summary-time").textContent = selectedTime;
            document.getElementById("summary-name").textContent = name;
            document.getElementById("summary-email").textContent = email;
            document.getElementById("summary-phone").textContent = phone;
        }

        document.getElementById("confirmBooking").addEventListener("click", () => {
            if (selectedTime) {
                const name = document.getElementById("nameInput").value;
                const email = document.getElementById("emailInput").value;
                const phone = document.getElementById("phoneInput").value;

                const bookingData = {
                    center: currentCenter,
                    date: selectedDate,
                    time: selectedTime,
                    name: name,
                    email: email,
                    phone: phone
                };

                fetch('http://localhost:3000/bookings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(bookingData)
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            bookedSlots.add(`${currentCenter}-${selectedDate}-${selectedTime}`);
                            updateSlots();
                            updateRecommendation();
                            alert("Booking confirmed! Check your email for a QR code.");
                        } else {
                            alert("Booking failed: " + data.message);
                        }
                    })
                    .catch(error => {
                        alert("Error connecting to server. Please try again later.");
                        console.error('Error:', error);
                    });
            }
        });
    </script>
</body>
</html>